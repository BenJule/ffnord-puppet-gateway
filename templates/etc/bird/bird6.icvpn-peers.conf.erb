# this is file is  generated by puppet

# bird6 icvpn peers configuration

# template for icvpn route exchange via bgp
template bgp icvpn {
  table mesh;
  local as <%= @icvpn_as %>;
  source address <%= @icvpn_ipv6_address %>;
  import where is_ula();
  export where (source = RTS_BGP) || (source = RTS_STATIC);
};

<% @icvpn_peerings.each do |peer| -%>
<% meta = YAML.load_file("/etc/tinc/icvpn/meta/" + peer + ".yaml") -%>
<% meta[peer]['icvpn-peers'].each_pair do |name,node| -%>

protocol bgp <%= peer %>_<%= name %> from icvpn {
  neighbor <%= node['ipv6'] %> as <%= meta[peer]['as'] %>;
};
<% end -%>
<% end -%>
